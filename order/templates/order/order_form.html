{% extends 'core/base.html' %}
{% load crispy_forms_tags %}

{%block title %} Checkout {% endblock %}

{% block content %}
<div class='container col-8'>
    <div class="py-5 text-center">
        <img class="d-block mx-auto mb-4" src="../assets/brand/bootstrap-logo.svg" alt="" width="72" height="57">
        <h2>Checkout form</h2>
        <p class="lead">Last step! Fill in the checkout form to complete the order. </p>
    </div>


    <div class="row g-5">
        <div class="col-md-5 col-lg-4 order-md-last">
            <h4 class="d-flex justify-content-between align-items-center mb-3">
                <span class="text-primary">Your cart</span>
                <span class="badge bg-primary rounded-pill">3</span>
            </h4>
            <ul class="list-group mb-3">
                {% for key, value in cart %}
                    <li class="list-group-item d-flex justify-content-between lh-sm">
                        <div>
                            <h6 class="my-0">{{ value.pretty_name }}</h6>
                            <small class="text-muted">{{  value.material }}, {{  value.colour }}</small>
                        </div>
                        <span class="text-muted">£{{  value.price }}</span>
                    </li>
                {% endfor %}

                <li class="list-group-item d-flex justify-content-between">
                    <span>Total (GBP)</span>
                    <strong>£</strong>
                </li>
            </ul>
        </div>
        <div class="col-md-7 col-lg-8">
            {% crispy form %}
        </div>

    </div>
    <hr>
    <div id="card-element">
        <!-- A Stripe Element will be inserted here -->
    </div>
</div>
{% endblock %}



<!-- {% block js %}
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        var stripe = Stripe('{{ stripe_pub_key }}');
        var elements = stripe.elements();

        var card = elements.create('card');

        card.mount('#card-element');

        var form = document.getElementById('payment-form');
        form.addEventListener('submit', function(event) {
            event.preventDefault();

            stripe.createToken(card).then(function(result) {
                if (result.error) {
                    var errorElement = document.getElementById('card-errors');
                    errorElement.textContent = result.error.message;
                } else {
                    stripeTokenHandler(result.token);
                }
            });
        });

        function stripeTokenHandler(token) {
            var form = document.getElementById('payment-form');
            var hiddenInput = document.createElement('input');
            hiddenInput.setAttribute('type', 'hidden');
            hiddenInput.setAttribute('name', 'stripe_token');
            hiddenInput.setAttribute('value', token.id);
            form.appendChild(hiddenInput);

            form.submit();
        }
    </script>
{% endblock %} -->